
<div class="row" ng-controller="TemplateExecutionDialogCtrl">

    <div class="col-sm-12 col-md-7">


        <form method="post" name="editForm" id="editForm">
            <div class="editor-fields" style="margin-bottom: 20px; padding-top: 0">

                <!-- ******************************************** -->
                <!-- ** >>>> Message Preamble Header           ** -->
                <!-- ******************************************** -->
                <div class="row editor-fields-group" style="margin-top: 0">
                    <div class="col-xs-4 col-sm-4 col-md-2">
                        <div class="editor-field-group-label" translate>editor.section.preamble</div>
                    </div>
                </div>

                <!-- ********************* -->
                <!-- ** Type            ** -->
                <!-- ********************* -->
                <editor-field edit-mode="editMode" field-id="type" field-title="msg.field.type"
                              ng-if="showStdTemplateField['type']" tab-index="200">

                    <editor-field-value-viewer>
                        <span ng-if="message.type">{{'msg.type.' + message.type | translate}} {{message.mainType}}</span>
                    </editor-field-value-viewer>

                    <editor-field-value-editor value-class="col-sm-12">
                        <div class="btn-group" ng-if="message.mainType == 'NW'">
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'LOCAL_WARNING'"
                                    tabindex="201" translate>msg.type.LOCAL_WARNING</button>
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'COASTAL_WARNING'"
                                    tabindex="202"  translate>msg.type.COASTAL_WARNING</button>
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'SUBAREA_WARNING'"
                                    tabindex="203"  translate>msg.type.SUBAREA_WARNING</button>
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'NAVAREA_WARNING'"
                                    tabindex="204"  translate>msg.type.NAVAREA_WARNING</button>
                        </div>
                        <div class="btn-group" ng-if="message.mainType == 'NM'">
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'TEMPORARY_NOTICE'"
                                    tabindex="205"  translate>msg.type.TEMPORARY_NOTICE</button>
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'PRELIMINARY_NOTICE'"
                                    tabindex="206"  translate>msg.type.PRELIMINARY_NOTICE</button>
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'PERMANENT_NOTICE'"
                                    tabindex="207"  translate>msg.type.PERMANENT_NOTICE</button>
                            <button class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'MISCELLANEOUS_NOTICE'"
                                    tabindex="208"  translate>msg.type.MISCELLANEOUS_NOTICE</button>
                        </div>
                    </editor-field-value-editor>

                </editor-field>

                <!-- ********************* -->
                <!-- ** Message ID      ** -->
                <!-- ********************* -->
                <editor-field edit-mode="editMode" field-id="id" field-title="msg.field.id"
                              ng-if="showStdTemplateField['id']" tab-index="300">

                    <editor-field-value-viewer>
                        <message-id-badge msg="message"></message-id-badge>
                    </editor-field-value-viewer>

                    <editor-field-value-editor value-class="col-sm-12">
                        <table class="editor-field-value-table">
                            <tr>
                                <th>Message series</th>
                                <td>
                                    <select class="form-control input-sm" style="width: 200px"
                                            tabindex="301"
                                            ng-model="message.messageSeries"
                                            ng-options="series.seriesId for series in messageSeries">
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </editor-field-value-editor>

                </editor-field>


                <!-- ********************* -->
                <!-- ** Publish Date    ** -->
                <!-- ********************* -->
                <editor-field edit-mode="editMode" field-id="publish_date" field-title="msg.field.publish_date"
                              ng-if="showStdTemplateField['publish_date']" tab-index="600">

                    <editor-field-value-viewer>
                        <div ng-if="message.publishDateFrom || message.publishDateTo">
                            <span ng-if="message.publishDateFrom">{{message.publishDateFrom | formatDate : 'lll z'}}</span>
                            <span ng-if="message.publishDateFrom || message.publishDateTo">&nbsp;-&nbsp;</span>
                            <span ng-if="message.publishDateTo">{{message.publishDateTo | formatDate : 'lll z'}}</span>
                        </div>
                    </editor-field-value-viewer>

                    <editor-field-value-editor value-class="col-sm-12">
                        <div class="row">
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <date-time-picker ng-model="message.publishDateFrom" placeholder="Publish From" format="'lll z'"
                                                  readonly="message.status != 'DRAFT' && message.status != 'VERIFIED'"
                                                  tab-index="601"></date-time-picker>
                            </div>
                            <div class="col-xs-6 col-sm-6 col-md-6">
                                <date-time-picker ng-model="message.publishDateTo" placeholder="Publish To" format="'lll z'"
                                                  readonly="message.status != 'DRAFT' && message.status != 'VERIFIED'  && message.status != 'PUBLISHED'"
                                                  tab-index="601"></date-time-picker>
                            </div>
                        </div>
                    </editor-field-value-editor>

                </editor-field>


                <!-- ********************* -->
                <!-- ** Areas           ** -->
                <!-- ********************* -->
                <editor-field edit-mode="editMode" field-id="areas" field-title="msg.field.areas"
                              ng-if="showStdTemplateField['areas']" tab-index="700">

                    <editor-field-value-viewer>
                        <span ng-repeat="area in message.areas"><span ng-if="$index > 0">,</span>
                            {{area.descs[0].name}}</span>
                            <span ng-if="message.descs.length > 0 && message.descs[0].vicinity">
                            <span ng-if="message.areas.length > 0">, </span>
                            {{message.descs[0].vicinity}}
                        </span>
                    </editor-field-value-viewer>

                    <editor-field-value-editor value-class="col-sm-12">
                        <div class="row">
                            <div class="col-sm-12">
                                <areas-field id="areas" area-data="message" multiple="true" domain="domain"
                                             tab-index="701"
                                             area-changed="adjustEditableMessage()"></areas-field>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 10px">
                            <div class="col-sm-6" ng-repeat="desc in message.descs">
                                <input class="form-control input-sm" placeholder="Vicinity" type="text"
                                       tabindex="704"
                                       ng-model="desc.vicinity" bg-flag="desc.lang"
                                       ng-change="adjustEditableMessage()"
                                       ng-model-options="{ updateOn: 'default blur', debounce: { default: 500, blur: 0 } }">
                            </div>
                        </div>
                    </editor-field-value-editor>

                </editor-field>
            </div>

        </form>

        <div style="text-align: center">
            <button class="btn btn-primary btn-sm" ng-click="executeTemplate()">Execute Template</button>
        </div>

    </div>

    <div class="col-sm-12 col-md-5">
        <div class="message-status-lang" style="text-align: center;">
            <span style="text-align: left">
                Preview &nbsp;
                <span ng-repeat="lang in modelLanguages" ng-click="previewLanguage(lang)"
                      style="padding-top: 4px; padding-bottom: 4px"
                      class="message-status-lang-btn pointer"
                      ng-class="{'preview-lang-selected' : previewLang == lang}">
                    <img ng-src="/img/flags/{{lang}}.png" height="14"/>
                    {{'lang.' + lang | translate}}
                </span>
            </span>
        </div>

        <ol-map ng-if="previewMessage" class="template-message-map">
            <map-tile-layer name="OSM" visible="true" layer-switcher="false" source="OSM"></map-tile-layer>
            <map-message-details-layer name="Message" visible="true" message="previewMessage"
                                       max-zoom="8" fit-extent="true"></map-message-details-layer>
        </ol-map>

        <table ng-if="previewMessage" class='table table-condensed'>
            <tr render-message-details
                msg="previewMessage"
                language="previewLang"
                format="details"
                show-promulgation="true"
                show-details-menu="false"></tr>
        </table>
    </div>
</div>
