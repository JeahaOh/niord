
<td class="message-details-image" style="border: none" ng-if="format == 'list'">
    <div class="message-selector-parent">
        <img ng-if="msg.id" ng-src="/rest/message-map-image/{{msg.id}}.png"
             message-details-link="msg.id" message-list="messageList" selection="selection"/>
        <span ng-if="showDetailsMenu != 'false'" class="select-btn"
              ng-click="toggleSelectMessage()" ng-class="{'message-selected' : isSelected()}">
            <span class="glyphicon glyphicon-star"></span>
        </span>
    </div>
</td>
<td class="message-details-item" style="border: none">

    <div style="position: relative; width: 100%;">

        <message-details-menu ng-if="showDetailsMenu != 'false'" style="position: absolute; top: 2px; right: 5px; z-index: 100"
                              message-id="msg.id" msg="msg" messages="messageList" size="xs"></message-details-menu>

        <!-- Attachments to be displayed above message -->
        <div class="row" ng-repeat="att in attachmentsAbove" ng-if="!compact">
            <div class="col-sm-12">
                <message-attachment message="msg" attachment="att" image-type="source" label-type="caption"></message-attachment>
            </div>
        </div>


        <!-- Title line -->
        <div ng-if="msg.originalInformation">&#9733;</div>
        <div ng-if="msg.shortId"><span class="label label-message-id">{{msg.shortId}}</span></div>
        <div message-details-link="msg.id" message-list="messageList"  selection="selection" disabled="format == 'details'">
            <strong>{{msg.descs[0].title}}</strong>
            <span ng-if="msg.descs[0].lang != language && !compact" style="color: darkgray;">
                <img ng-src="/img/flags/{{msg.descs[0].lang}}.png" style="height: 12px; opacity: 0.5;"/>
            </span>
        </div>


        <table class="message-details-item-fields">

            <!-- Reference lines -->
            <tr ng-if="msg.references && msg.references.length > 0">
                <th translate>msg.field.references</th>
                <td>
                    <div ng-repeat="ref in msg.references">
                        <a href ng-click="referenceClicked(ref.messageId)">{{ref.messageId}}</a>
                        <span ng-switch="ref.type">
                            <span ng-switch-when="REPETITION" translate>msg.reference.repetition</span>
                            <span ng-switch-when="CANCELLATION" translate>msg.reference.cancelled</span>
                            <span ng-switch-when="UPDATE" translate>msg.reference.updated</span>
                        </span>
                        <span ng-if="ref.descs && ref.descs.length > 0 && ref.descs[0].description">- {{ref.descs[0].description}}</span>
                    </div>
                </td>
            </tr>


            <!-- Time line -->
            <tr ng-if="msg.descs[0].time || (msg.dateIntervals && msg.dateIntervals.length > 0)">
                <th translate>msg.field.time</th>
                <td><render-message-dates msg="msg"></render-message-dates></td>
            </tr>


            <!-- Geometry line -->
            <tr ng-if="msg.geometry && msg.geometry.features && msg.geometry.features.length > 0">
                <th translate>msg.field.positions</th>
                <td>
                    <div ng-if="!compact">
                        <span class="glyphicon glyphicon-map-marker" style="color: darkgray"></span>
                        <a href ng-if="showLocations" ng-click="setShowLocations(false)" class="clickable" translate>msg.hide_positions</a>
                        <a href ng-if="!showLocations" ng-click="setShowLocations(true)" class="clickable" translate>msg.show_positions</a>
                    </div>
                    <div ng-if="showLocations || compact">
                        <div ng-repeat="featureCoords in serializeCoordinates()">
                            <div ng-if="featureCoords.name" class="message-details-position-names">{{featureCoords.name}}</div>
                            <ol class="message-details-positions" start="{{featureCoords.startIndex}}">
                                <li ng-repeat="c in featureCoords.coords">
                                    <span>{{c | lonlat:{ decimals : 3, pp: true } }}<span ng-if="c.name">, {{c.name}}</span></span>
                                </li>
                            </ol>
                        </div>
                    </div>
                </td>
            </tr>


            <!-- Details line -->
            <tr ng-if="msg.descs[0].description">
                <th translate>msg.field.details</th>
                <td class="message-description" ng-bind-html="msg.descs[0].description | toTrusted"></td>
            </tr>


            <!-- Attachments -->
            <tr ng-if="msg.attachments">
                <th translate>msg.field.attachments</th>
                <td>
                    <div ng-if="!compact">
                        <span class="glyphicon glyphicon-paperclip" style="color: darkgray"></span>
                        <a href ng-if="showAttachments" ng-click="setShowAttachments(false)" class="clickable" translate>msg.hide_attachments</a>
                        <a href ng-if="!showAttachments" ng-click="setShowAttachments(true)" class="clickable" translate>msg.show_attachments</a>
                    </div>
                    <div ng-if="showAttachments || compact">
                        <span class="attachment-list" ng-repeat="att in msg.attachments">
                            <message-attachment message="msg" attachment="att" size="32"></message-attachment>
                        </span>
                    </div>
                </td>
            </tr>


            <!-- Prohibition line -->
            <tr ng-if="msg.descs[0].prohibition">
                <th translate>msg.field.prohibition</th>
                <td>{{msg.descs[0].prohibition}}</td>
            </tr>


            <!-- Signals line -->
            <tr ng-if="msg.descs[0].signals">
                <th translate>msg.field.signals</th>
                <td ng-bind-html="msg.descs[0].signals | plain2html"></td>
            </tr>


            <!-- Note line -->
            <tr ng-if="msg.descs[0].note">
                <th translate>msg.field.note</th>
                <td ng-bind-html="msg.descs[0].note | plain2html"></td>
            </tr>


            <!-- Charts line -->
            <tr ng-if="msg.charts.length > 0">
                <th translate>msg.field.charts</th>
                <td>
                    <span render-charts="msg.charts"></span>
                </td>
            </tr>


            <!-- Publication line -->
            <tr ng-if="msg.descs[0].publication">
                <th translate>msg.field.publication</th>
                <td>{{msg.descs[0].publication}}</td>
            </tr>


            <!-- Source line -->
            <tr ng-if="msg.descs[0].source">
                <td colspan="2" class="text-right">({{msg.descs[0].source}})</td>
            </tr>

        </table>

        <!-- Attachments to be displayed below message -->
        <div class="row" ng-repeat="att in attachmentsBelow" ng-if="!compact">
            <div class="col-sm-12">
                <message-attachment message="msg" attachment="att" image-type="source" label-type="caption"></message-attachment>
            </div>
        </div>

    </div>
</td>
