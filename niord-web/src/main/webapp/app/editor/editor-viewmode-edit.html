
<div class="editor-contents container">
    <h3 class="page-header">
        Message Editor

        <a ng-href="{{backToListUrl}}" ng-if="backToListUrl"
           class="btn btn-default btn-xs pull-right">
            <span class="glyphicon glyphicon-arrow-left"></span> Back to list
        </a>
    </h3>

    <div ng-if="!message || !message.mainType" style="margin-top: 10px">
        <button class="btn btn-sm btn-primary" ng-if="canCreateMessage('NW')" ng-click="createMessage('NW')"
                ng-disabled="selection.isEmpty()">New NW</button>
        <button class="btn btn-sm btn-primary" ng-if="canCreateMessage('NM')" ng-click="createMessage('NM')"
                ng-disabled="selection.isEmpty()">New NM</button>
    </div>


    <div ng-if="message && message.mainType && !editable()" class="col-sm-12 col-md-8 col-lg-9">
        <div class="empty-search-result">
            <p>Message not editable</p>
        </div>
        <table ng-if="message.id" class='table table-condensed'>
            <tr render-message-details msg="message" format="details" show-details-menu="false"></tr>
        </table>
    </div>


    <form ng-if="message && message.mainType && editable()" method="post" name="editForm" id="editForm">
        <div class="editor-fields" style="margin-bottom: 40px;">

            <!-- ********************* -->
            <!-- ** Type            ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="type" field-title="msg.field.type" field-valid="fieldValid(fieldId)">

                <editor-field-value-viewer>
                    <span ng-if="message.type">{{'msg.type.' + message.type | translate}} {{message.mainType}}</span>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12 col-md-6 col-lg-4">
                    <div class="btn-group" ng-if="message.mainType == 'NW' || supportsNw(true)">
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'LOCAL_WARNING'" translate>msg.type.LOCAL_WARNING</label>
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'COASTAL_WARNING'" translate>msg.type.COASTAL_WARNING</label>
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'SUBAREA_WARNING'" translate>msg.type.SUBAREA_WARNING</label>
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'NAVAREA_WARNING'" translate>msg.type.NAVAREA_WARNING</label>
                    </div>
                    <div class="btn-group" ng-if="message.mainType == 'NM' || supportsNm(true)">
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'TEMPORARY_NOTICE'" translate>msg.type.TEMPORARY_NOTICE</label>
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'PRELIMINARY_NOTICE'" translate>msg.type.PRELIMINARY_NOTICE</label>
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'PERMANENT_NOTICE'" translate>msg.type.PERMANENT_NOTICE</label>
                        <label class="btn btn-default btn-sm" ng-model="message.type" uib-btn-radio="'MISCELLANEOUS_NOTICE'" translate>msg.type.MISCELLANEOUS_NOTICE</label>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Original Info   ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('orig_info')" edit-mode="editMode" field-id="orig_info" field-title="msg.field.orig_info">

                <editor-field-value-viewer>
                    <div ng-if="message.originalInformation">&#9733;</div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <button type="button" class="btn btn-sm btn-default" ng-model="message.originalInformation"
                            uib-btn-checkbox uib-btn-checkbox-true="true" uib-btn-checkbox-false="false">
                        <span class="glyphicon glyphicon-star"></span>
                    </button>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Message ID      ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="id" field-title="msg.field.id" field-valid="fieldValid(fieldId)">

                <editor-field-value-viewer>
                    <message-id-badge msg="message"></message-id-badge>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <table class="editor-field-value-table">
                        <tr>
                            <th>Message series</th>
                            <td>
                                <select class="form-control input-sm" style="width: 200px"
                                        ng-model="message.messageSeries"
                                        ng-options="series.seriesId for series in messageSeries">
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>UID</th>
                            <td>{{message.id}}</td>
                        </tr>
                        <tr ng-if="numberSequenceType() != 'NONE'">
                            <th>Short ID</th>
                            <td>
                                <message-id-badge ng-if="!mrnAndShortIdEditable()" msg="message"></message-id-badge>
                                <div ng-if="mrnAndShortIdEditable()">
                                    <input class="form-control input-sm" placeholder="Short ID" type="text"
                                           autocapitalize="off" autocorrect="off" autocomplete="off"
                                           ng-model="message.shortId"/>
                                </div>
                            </td>
                        </tr>
                        <tr ng-if="numberSequenceType() != 'NONE'">
                            <th>MRN</th>
                            <td>
                                <span ng-if="!mrnAndShortIdEditable()">{{message.mrn}}</span>
                                <div ng-if="mrnAndShortIdEditable()">
                                    <input class="form-control input-sm" placeholder="MRN" type="text"
                                           autocapitalize="off" autocorrect="off" autocomplete="off"
                                           ng-model="message.mrn"/>
                                </div>
                            </td>
                        </tr>
                    </table>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Title line      ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="title" field-title="msg.field.title">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0">
                        <strong>{{message.descs[0].title}}</strong>
                        <span ng-if="message.descs[0].lang != language" style="color: darkgray;">
                            <img ng-src="/img/flags/{{message.descs[0].lang}}.png" style="height: 12px; opacity: 0.5;"/>
                        </span>
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row" style="margin-top: 10px">
                        <div class="col-sm-12">
                            <button type="button" class="btn btn-sm btn-default" ng-model="message.autoTitle"
                                    uib-btn-checkbox uib-btn-checkbox-true="true" uib-btn-checkbox-false="false">
                                <span class="glyphicon glyphicon-lock"></span> Auto-generate
                            </button>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 10px">
                        <div class="col-sm-12 col-md-8" ng-repeat="desc in message.descs">
                            <input class="form-control input-sm" placeholder="Title" type="text"
                                   ng-model="desc.title" bg-flag="desc.lang" ng-disabled="message.autoTitle">
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** References      ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="references" field-title="msg.field.references">

                <editor-field-value-viewer>
                    <div ng-repeat="ref in message.references">
                        <a href ng-click="referenceClicked(ref.messageId)">{{ref.messageId}}</a>
                        <span ng-switch="ref.type">
                            <span ng-switch-when="REPETITION" translate>msg.reference.repetition</span>
                            <span ng-switch-when="CANCELLATION" translate>msg.reference.cancelled</span>
                            <span ng-switch-when="UPDATE" translate>msg.reference.updated</span>
                        </span>
                        <span ng-if="ref.descs.length > 0">{{ref.descs[0].description}}</span>
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <table class="table table-condensed editor-reference-table">
                        <tr>
                            <th>Message</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>
                                <div class="pull-right">
                                    <button ng-click="addReference()" class="btn btn-default btn-xs">
                                        <span class="glyphicon glyphicon-plus"></span> Add
                                    </button>
                                </div>
                            </th>
                        </tr>
                        <tbody ng-sortable="referencesSortableCfg">
                            <tr ng-repeat="ref in message.references">
                                <td width="30%">
                                    <message-id-field reference="ref"></message-id-field>
                                </td>
                                <td width="120">
                                    <select class="form-control input-sm" ng-model="ref.type">
                                        <option value="REFERENCE" translate>msg.reference.reference</option>
                                        <option value="REPETITION" translate>msg.reference.repetition</option>
                                        <option value="CANCELLATION" translate>msg.reference.cancelled</option>
                                        <option value="UPDATE" translate>msg.reference.updated</option>
                                    </select>
                                </td>
                                <td width="*">
                                    <div ng-repeat="desc in ref.descs">
                                        <input class="form-control input-sm" placeholder="Description" type="text"
                                               ng-model="desc.description" bg-flag="desc.lang"/>
                                    </div>
                                </td>
                                <td style="width: 50px; padding-top: 12px" nowrap>
                                    <a href ng-click="deleteReference(ref);" title="Delete Reference"><i class="glyphicon glyphicon-trash"></i></a>
                                    &nbsp;
                                    <a href><span class="glyphicon glyphicon-move move-btn"></span></a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Time            ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="time" field-title="msg.field.time" field-valid="fieldValid(fieldId)">

                <editor-field-value-viewer>
                    <div ng-if="message.publishDate && (message.status == 'DRAFT' || message.status == 'VERIFIED')">
                        Publish: {{message.publishDate | formatDate : 'lll z'}}
                    </div>
                    <render-message-dates msg="message"></render-message-dates>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row" style="margin-bottom: 25px;"
                         ng-if="message.status == 'DRAFT' || message.status == 'VERIFIED'">
                        <div class="col-sm-4 col-md-4 col-lg-2 editor-date-label">Publish Date</div>
                        <div class="col-sm-8 col-md-4">
                            <date-time-picker ng-model="message.publishDate" placeholder="Publish date" format="'lll z'"></date-time-picker>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 editor-date-label">Active Date Intervals</div>
                    </div>
                    <table class="table table-condensed editor-date-interval-table">
                        <tr>
                            <th>All-day</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>
                                <div class="pull-right">
                                    <button ng-click="addDateInterval()" class="btn btn-default btn-xs">
                                        <span class="glyphicon glyphicon-plus"></span> Add
                                    </button>
                                </div>
                            </th>
                        </tr>
                        <tr ng-repeat="di in message.dateIntervals">
                            <td width="60" style="padding-top: 10px" align="center">
                                <input type="checkbox" ng-model="di.allDay">
                            </td>
                            <td width="220">
                                <date-time-picker ng-model="di.fromDate" placeholder="From date"
                                                  time="di.allDay ? '00:00:00' : undefined" format="di.allDay ? 'll' : 'lll z'"></date-time-picker>
                            </td>
                            <td width="220">
                                <date-time-picker ng-model="di.toDate" placeholder="To date"
                                                  time="di.allDay ? '23:59:59' : undefined" format="di.allDay ? 'll' : 'lll z'"></date-time-picker>
                            </td>
                            <td width="*" style="padding-top: 12px" nowrap>
                                <a href ng-click="deleteDateInterval(di);" title="Delete Interval"><span class="glyphicon glyphicon-trash"></span></a>
                                &nbsp;
                                <a href ng-click="copyDateInterval(di, 0);" title="Duplicate Interval"><span class="glyphicon glyphicon-duplicate"></span></a>
                                &nbsp;
                                <a href ng-click="copyDateInterval(di, 1);" title="Duplicate Interval + 1 day">
                                    <span class="glyphicon glyphicon-duplicate">+</span></a>
                            </td>
                        </tr>
                    </table>

                    <div class="row" style="margin-top: 25px;">
                        <div class="col-sm-12 editor-date-label">Alternative Textual Description</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-md-5" ng-repeat="desc in message.descs">
                            <textarea class="form-control input-sm editor-time" placeholder="Time Description" rows="3"
                                      ng-model="desc.time" bg-flag="desc.lang" ></textarea>
                        </div>
                        <div class="col-sm-2 col-md-1">
                            <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown"
                                    ng-click="generateTimeDesc()">
                                <span class="glyphicon glyphicon-cog"></span>
                                Generate
                            </button>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Areas           ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="areas" field-title="msg.field.areas" field-valid="fieldValid(fieldId)">

                <editor-field-value-viewer>
                    <span ng-repeat="area in message.areas"><span ng-if="$index > 0">,</span>
                        {{area.descs[0].name}}</span>
                    <span ng-if="message.descs.length > 0 && message.descs[0].vicinity">
                        <span ng-if="message.areas.length > 0">, </span>
                        {{message.descs[0].vicinity}}
                    </span>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12 col-md-8">
                    <div class="row">
                        <div class="col-sm-6">
                            <areas-field id="areas" area-data="message" multiple="true" domain="true" area-changed="adjustEditableMessage()"></areas-field>
                        </div>
                        <div class="col-sm-4">
                            <button href class="btn btn-default btn-sm" ng-disabled="!message.areas || message.areas.length == 0"
                                    ng-click="copyAreaLocations()">Copy Locations</button>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 10px">
                        <div class="col-sm-6" ng-repeat="desc in message.descs">
                            <input class="form-control input-sm" placeholder="Vicinity" type="text"
                                   ng-model="desc.vicinity" bg-flag="desc.lang"
                                   ng-change="adjustEditableMessage()"
                                   ng-model-options="{ updateOn: 'default blur', debounce: { default: 500, blur: 0 } }">
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Positions       ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="positions" field-title="msg.field.positions">

                <editor-field-value-viewer>
                    <div ng-if="featureCoordinates.length > 0">
                        <span class="glyphicon glyphicon-map-marker" style="color: darkgray"></span>
                        <a href ng-if="showCoordinates" ng-click="toggleShowCoordinates()" class="clickable" translate>msg.hide_positions</a>
                        <a href ng-if="!showCoordinates" ng-click="toggleShowCoordinates()" class="clickable" translate>msg.show_positions</a>
                    </div>
                    <div ng-if="showCoordinates">
                        <div ng-repeat="featureCoords in featureCoordinates">
                            <div ng-if="featureCoords.name" class="message-details-position-names">{{featureCoords.name}}</div>
                            <ol class="message-details-positions" start="{{featureCoords.startIndex}}">
                                <li ng-repeat="c in featureCoords.coords">
                                    <span>{{c | lonlat:{ decimals : 3, pp: true } }}<span ng-if="c.name">, {{c.name}}</span></span>
                                </li>
                            </ol>
                        </div>
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6 col-lg-8 ">
                            <gj-editor id="position-editor"
                                       class="editor-locations"
                                       edit-type="message"
                                       feature-collection="message.geometry"
                                       on-save="geometrySaved(featureCollection)"></gj-editor>
                        </div>

                        <div class="col-sm-12 col-md-6 col-lg-4">

                            <div class="editor-map-image-thumbnail">
                                <img ng-src="/rest/message-map-image/{{message.editRepoPath}}/image.png?{{imgCacheBreaker}}" width="256" height="256"/>

                                <div class="editor-map-image-menu text-center">
                                    <div class="btn-group" uib-dropdown>
                                        <button type="button" class="btn btn-sm btn-default" uib-dropdown-toggle>
                                            <span class="glyphicon glyphicon-camera"></span>
                                            Thumbnail
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">
                                            <li role="menuitem"><a href ng-click="messageThumbnailDialog()">Select thumbnail...</a></li>
                                            <li role="menuitem"><a href ng-click="uploadMessageThumbnailDialog()">Upload thumbnail...</a></li>
                                            <li role="menuitem"><a href ng-click="clearMessageThumbnail()">Clear thumbnail</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Charts          ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="charts" field-title="msg.field.charts">

                <editor-field-value-viewer>
                    <span render-charts="message.charts"></span>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12 col-md-10">
                    <div class="row">
                        <div class="col-sm-6 col-md-8">
                            <charts-field id="charts" chart-data="message" multiple="true"></charts-field>
                        </div>
                        <div class="col-sm-6 col-md-4">
                            <button href class="btn btn-default btn-sm" ng-disabled="message.geometry.features.length == 0"
                                    ng-click="computeCharts()">Compute from Locations</button>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 10px">
                        <div class="col-sm-6 col-md-4">
                            <input type="text" class="form-control input-sm" placeholder="Horizontal Datum"
                                   ng-model="message.horizontalDatum" />
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Categories      ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="categories" field-title="msg.field.categories">

                <editor-field-value-viewer>
                    <span ng-repeat="category in message.categories"><span ng-if="$index > 0">,</span> {{category.descs[0].name}}</span>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12 col-md-6">
                    <categories-field id="categories" category-data="message" multiple="true" domain="true" category-changed="adjustEditableMessage()"></categories-field>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Subject         ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="subject" field-title="msg.field.subject">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0">
                        {{message.descs[0].subject}}
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs">
                            <input class="form-control input-sm" placeholder="Subject" type="text"
                                   autocapitalize="off" autocorrect="off" autocomplete="off"
                                   ng-model="desc.subject" bg-flag="desc.lang"
                                   ng-change="adjustEditableMessage()"
                                   ng-model-options="{ updateOn: 'default blur', debounce: { default: 500, blur: 0 } }"/>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>

            <!-- ********************* -->
            <!-- ** Description     ** -->
            <!-- ********************* -->
            <editor-field edit-mode="editMode" field-id="description" field-title="msg.field.description">

                <editor-field-value-viewer>
                    <div class="message-description" ng-if="message.descs.length > 0" ng-bind-html="message.descs[0].description | toTrusted"></div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs"  id="tinymce-{{desc.lang}}">
                            <textarea class="editor-description" ui-tinymce="tinymceOptions"
                                      ng-model="desc.description" bg-flag="desc.lang"></textarea>
                            <flag lang="desc.lang" class="editor-description-flag"></flag>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Attachments     ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('attachments')" edit-mode="editMode" field-id="attachments" field-title="msg.field.attachments">

                <editor-field-value-viewer>
                    <div ng-if="message.attachments.length > 0">
                        <span class="glyphicon glyphicon-paperclip" style="color: darkgray">{{message.attachments.length}}:</span>
                        <span ng-repeat="att in message.attachments"><span ng-if="$index > 0">,</span>
                            {{att.fileName}}
                        </span>
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">

                    <div class="editor-attachments">
                        <div class="editor-file-upload">
                            <file-upload url="attachmentUploadUrl"
                                         drop-text="or drop file here"
                                         multiple="true"
                                         auto-upload="true"
                                         remove-after-upload="true"
                                         success="attachmentsUploaded(result)"
                                         error="attachmentsUploadError(status, statusText)"></file-upload>
                        </div>


                        <div ng-if="message.attachments.length > 0">
                            <table class="table table-condensed editor-attachment-table">
                                <tr>
                                    <th>Icon</th>
                                    <th>Caption</th>
                                    <th>Display</th>
                                    <th>Size</th>
                                    <th></th>
                                </tr>
                                <tr ng-repeat="att in message.attachments">
                                    <td width="70">
                                        <message-attachment message="message" attachment="att" size="32"></message-attachment>
                                    </td>
                                    <td>
                                        <div ng-repeat="desc in att.descs">
                                            <input class="form-control input-sm" placeholder="Caption" type="text"
                                                   ng-model="desc.caption" bg-flag="desc.lang"/>
                                        </div>
                                    </td>
                                    <td width="180">
                                        <select class="form-control input-sm" ng-model="att.display" ng-if="canDisplayAttachment(att)"
                                                ng-change="attachmentDisplayUpdated(att)">
                                            <option value="">&lt;none&gt;</option>
                                            <option value="ABOVE">Above message</option>
                                            <option value="BELOW">Below message</option>
                                            <option value="SEPARATE_PAGE">Separate page (PDF)</option>
                                        </select>
                                    </td>
                                    <td width="100">
                                        <input type="text" class="form-control input-sm" placeholder="Width"
                                               ng-if="canDisplayAttachment(att) && att.display" ng-model="att.width"
                                               pattern="\d+(\.\d*)?(em|px|%|cm|mm|in|pt|pc)">
                                        <input type="text" class="form-control input-sm" placeholder="Height"
                                               ng-if="canDisplayAttachment(att) && att.display" ng-model="att.height"
                                               pattern="\d+(\.\d*)?(em|px|%|cm|mm|in|pt|pc)">
                                    </td>
                                    <td width="30">
                                        <a href ng-click="deleteAttachment(att);" title="Delete Attachment"><span class="glyphicon glyphicon-trash"></span></a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Prohibition     ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('prohibition')" edit-mode="editMode" field-id="prohibition" field-title="msg.field.prohibition">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0">
                        {{message.descs[0].prohibition}}
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs">
                            <input class="form-control input-sm" placeholder="Prohibition" type="text"
                                   autocapitalize="off" autocorrect="off" autocomplete="off"
                                   ng-model="desc.prohibition" bg-flag="desc.lang"/>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Signals         ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('signals')" edit-mode="editMode" field-id="signals" field-title="msg.field.signals">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0" ng-bind-html="message.descs[0].signals | plain2html"></div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs">
                            <textarea rows="3" class="form-control input-sm" placeholder="Signals" type="text"
                                      autocapitalize="off" autocorrect="off" autocomplete="off"
                                      ng-model="desc.signals" bg-flag="desc.lang"></textarea>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Note            ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('note')" edit-mode="editMode" field-id="note" field-title="msg.field.note">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0" ng-bind-html="message.descs[0].note | plain2html"></div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs">
                            <textarea rows="3" class="form-control input-sm" placeholder="Note" type="text"
                                   autocapitalize="off" autocorrect="off" autocomplete="off"
                                   ng-model="desc.note" bg-flag="desc.lang"></textarea>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Publication     ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('publication')" edit-mode="editMode" field-id="publication" field-title="msg.field.publication">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0">
                        {{message.descs[0].publication}}
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs">
                            <input class="form-control input-sm" placeholder="Publication" type="text"
                                   autocapitalize="off" autocorrect="off" autocomplete="off"
                                   ng-model="desc.publication" bg-flag="desc.lang"/>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>


            <!-- ********************* -->
            <!-- ** Source          ** -->
            <!-- ********************* -->
            <editor-field ng-if="showField('source')" edit-mode="editMode" field-id="source" field-title="msg.field.source">

                <editor-field-value-viewer>
                    <div ng-if="message.descs.length > 0">
                        {{message.descs[0].source}}
                    </div>
                </editor-field-value-viewer>

                <editor-field-value-editor value-class="col-sm-12">
                    <div class="row">
                        <div class="col-sm-12 col-md-6" ng-repeat="desc in message.descs">
                            <input class="form-control input-sm" placeholder="Source" type="text"
                                   autocapitalize="off" autocorrect="off" autocomplete="off"
                                   ng-model="desc.source" bg-flag="desc.lang"/>
                        </div>
                    </div>
                </editor-field-value-editor>

            </editor-field>

        </div>

        <!-- Save and revert buttons -->
        <div id="save" class="row editor-section">
            <button href class="btn btn-primary btn-sm" ng-click="saveMessage()" ng-disabled="editForm.$pristine || editForm.$invalid || messageSaving">
                <span class="glyphicon glyphicon-floppy-disk"></span> Save Message
            </button>
            <button href class="btn btn-default btn-sm" ng-click="init()" ng-if="initId">
                <span class="glyphicon glyphicon-refresh"></span> Reload Message
            </button>
        </div>


    </form>

</div>
